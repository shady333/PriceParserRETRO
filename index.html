<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ—à—É–∫ —Ü—ñ–Ω –Ω–∞ –º–∞—à–∏–Ω–∫–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input { padding: 10px; width: 300px; }
        button { padding: 10px; }
        #result { margin-top: 20px; }
        table { border-collapse: collapse; width: 100%; max-width: 600px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h2>–ü–æ—à—É–∫ —Ü—ñ–Ω –Ω–∞ –º–∞—à–∏–Ω–∫–∏</h2>
    <input type="text" id="searchInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º–∞—à–∏–Ω–∫–∏">
    <button onclick="searchCar()">–®—É–∫–∞—Ç–∏</button>
    <div id="result"></div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        function searchCar() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().replace(/"/g, '');
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';

            // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è CSV –∑ GitHub
            Papa.parse('https://raw.githubusercontent.com/–í–ê–®_–ö–û–†–ò–°–¢–£–í–ê–ß/–í–ê–®_–†–ï–ü–û–ó–ò–¢–û–†–Ü–ô/main/data/car_prices.csv', {
                download: true,
                header: true,
                complete: function(results) {
                    const data = results.data;
                    const found = data.find(row => 
                        row.car_name && row.car_name.toLowerCase().replace(/"/g, '').includes(searchTerm)
                    );

                    if (found) {
                        // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –æ—Å—Ç–∞–Ω–Ω—é —Ü—ñ–Ω—É —Ç–∞ –¥–∞—Ç—É
                        let lastPrice = null;
                        let lastDate = null;
                        for (const key in found) {
                            if (key !== 'category' && key !== 'car_name' && found[key] && !isNaN(found[key])) {
                                if (!lastDate || key > lastDate) {
                                    lastPrice = parseFloat(found[key]);
                                    lastDate = key;
                                }
                            }
                        }

                        // –û–±—á–∏—Å–ª—é—î–º–æ —Ç—Ä–µ–Ω–¥ —Ü—ñ–Ω
                        let trend = '';
                        const prices = [];
                        for (const key in found) {
                            if (key !== 'category' && key !== 'car_name' && found[key] && !isNaN(found[key])) {
                                prices.push({ date: key, price: parseFloat(found[key]) });
                            }
                        }
                        prices.sort((a, b) => new Date(a.date) - new Date(b.date));
                        if (prices.length >= 2) {
                            const lastTwo = prices.slice(-2);
                            if (lastTwo[1].price > lastTwo[0].price) {
                                trend = 'üìà –ó—Ä–æ—Å—Ç–∞–Ω–Ω—è';
                            } else if (lastTwo[1].price < lastTwo[0].price) {
                                trend = 'üìâ –ü–∞–¥—ñ–Ω–Ω—è';
                            } else {
                                trend = '‚ûñ –ë–µ–∑ –∑–º—ñ–Ω';
                            }
                        } else {
                            trend = '–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –¥–ª—è —Ç—Ä–µ–Ω–¥—É';
                        }

                        // –í–∏–≤–µ–¥–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                        resultDiv.innerHTML = `
                            <h3>–ó–Ω–∞–π–¥–µ–Ω–æ: ${found.car_name}</h3>
                            <table>
                                <tr><th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th><td>${found.category}</td></tr>
                                <tr><th>–û—Å—Ç–∞–Ω–Ω—è —Ü—ñ–Ω–∞</th><td>${lastPrice} –≥—Ä–Ω</td></tr>
                                <tr><th>–î–∞—Ç–∞</th><td>${lastDate}</td></tr>
                                <tr><th>–¢—Ä–µ–Ω–¥ —Ü—ñ–Ω</th><td>${trend}</td></tr>
                            </table>
                        `;
                    } else {
                        resultDiv.innerHTML = '–ú–∞—à–∏–Ω–∫—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
                    }
                },
                error: function(error) {
                    resultDiv.innerHTML = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è CSV: ' + error;
                }
            });
        }
    </script>
</body>
</html>
